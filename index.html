<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Proyecto Study IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --color-background: #E0E5EC;
            --color-text: #555;
            --color-primary: #6D55FF; /* A vibrant purple */
            --color-primary-light: #A599FF;
            --color-primary-dark: #4A3AFF;
            --color-accent: #FFAB76; /* A warm accent */
            --color-success: #3DDC97;
            --color-error: #FF6B6B;

            --neumorphism-light-shadow: -9px -9px 16px #ffffff, 9px 9px 16px #a3b1c6;
            --neumorphism-light-shadow-inset: inset -7px -7px 14px #ffffff, inset 7px 7px 14px #a3b1c6;
            
            /* Dark mode would have different shadow values if implemented */
            /* --neumorphism-dark-shadow: -9px -9px 16px #2c2f33, 9px 9px 16px #1a1c1e; */
            /* --neumorphism-dark-shadow-inset: inset -7px -7px 14px #2c2f33, inset 7px 7px 14px #1a1c1e; */

            --current-shadow: var(--neumorphism-light-shadow);
            --current-shadow-inset: var(--neumorphism-light-shadow-inset);
            
            --font-main: 'Poppins', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Neumorphic Card */
        .neumorphic-card {
            background-color: var(--color-background);
            border-radius: 25px; /* Slightly more rounded */
            padding: clamp(1.5rem, 5vw, 2.5rem); /* Responsive padding */
            box-shadow: var(--current-shadow);
            transition: box-shadow 0.25s ease-in-out;
        }
        .neumorphic-card:hover {
            box-shadow: -6px -6px 12px #ffffff, 6px 6px 12px #a3b1c6;
        }

        /* Neumorphic Button */
        .neumorphic-button {
            background-color: var(--color-background);
            border: none;
            border-radius: 15px;
            padding: 0.8rem 1.8rem;
            font-weight: 600;
            color: var(--color-primary);
            box-shadow: var(--current-shadow);
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            outline: none;
            text-align: center;
        }
        .neumorphic-button:hover {
            color: var(--color-primary-dark);
            box-shadow: -6px -6px 12px #ffffff, 6px 6px 12px #a3b1c6;
        }
        .neumorphic-button:active {
            box-shadow: var(--current-shadow-inset);
            color: var(--color-primary-light);
            transform: translateY(1px); /* Slight press effect */
        }
        .neumorphic-button-primary {
            color: white;
            background-color: var(--color-primary);
        }
        .neumorphic-button-primary:hover {
            background-color: var(--color-primary-dark);
            color: white; /* Ensure text remains white */
        }
        .neumorphic-button-primary:active {
             background-color: var(--color-primary-light);
             color: white; /* Ensure text remains white */
        }
        .neumorphic-button.disabled, .neumorphic-button:disabled {
            opacity: 0.7;
            box-shadow: var(--current-shadow-inset); /* Make it look pressed / inactive */
            cursor: not-allowed;
        }


        /* Neumorphic Input */
        .neumorphic-input {
            background-color: var(--color-background);
            border: none;
            border-radius: 15px;
            padding: 0.9rem 1.2rem;
            box-shadow: var(--current-shadow-inset);
            color: var(--color-text);
            width: 100%;
            transition: box-shadow 0.2s ease;
        }
        .neumorphic-input:focus {
            outline: none;
            /* A subtle outer glow to indicate focus, complementing inset shadow */
            box-shadow: var(--current-shadow-inset), 
                        0 0 0 3px rgba(var(--color-primary-rgb, 109 85 255) / 0.3); 
        }
        /* Adding --color-primary-rgb for the focus ring */
        :root { --color-primary-rgb: 109, 85, 255; }


        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* Darker overlay for more focus */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px); /* Frosted glass effect for background */
        }
        .modal-content {
            margin: auto;
            padding: clamp(20px, 5vw, 40px);
            border-radius: 25px;
            width: 90%;
            max-width: 550px;
            position: relative;
            text-align: left;
            animation: slideInModal 0.3s ease-out;
        }
        @keyframes slideInModal {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-close {
            color: var(--color-text);
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover { color: var(--color-primary); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--color-background); }
        ::-webkit-scrollbar-thumb { background: var(--color-primary-light); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-primary); }

        /* Utility classes */
        .text-primary { color: var(--color-primary); }
        .text-accent { color: var(--color-accent); }
        .bg-primary-light-transparent { background-color: rgba(var(--color-primary-rgb), 0.1); } /* For subtle backgrounds */
        
        /* Responsive header & Nav Link Styling */
        #mainHeader nav a { 
            margin: 0 12px; 
            padding: 8px 15px; 
            border-radius: 12px; 
            transition: background-color 0.2s, box-shadow 0.2s, color 0.2s;
            font-weight: 500; /* Slightly less bold than buttons */
        }
        #mainHeader nav a:hover, #mainHeader nav a.active-link {
            background-color: var(--color-background); /* Matches body for seamless look */
            box-shadow: -4px -4px 8px #ffffff, 4px 4px 8px #a3b1c6; /* Softer shadow for links */
            color: var(--color-primary);
        }
        #mobileMenuBtn { display: none; }
        @media (max-width: 768px) {
            #mainHeaderContainer { flex-wrap: wrap; }
            #mainNav { 
                display: none; /* Controlled by JS */
                flex-direction: column; 
                width: 100%; 
                order: 3; /* Place it below logo and mobile button */
                margin-top: 1rem;
                background-color: var(--color-background);
                border-radius: 20px;
                box-shadow: var(--current-shadow);
                padding: 1rem 0;
            }
            #mainNav.active { display: flex; } /* JS toggles this */
            #mainNav a { margin: 8px 0; display:block; text-align: center; width: 90%; margin-left:auto; margin-right:auto;}
            #mobileMenuBtn { display: block; }
            .user-profile-container { margin-top: 10px; width:100%; justify-content: center;}
        }
        .user-profile-container { display: flex; align-items: center; }

        /* Section title styling */
        .section-title {
            font-size: clamp(1.8rem, 5vw, 2.5rem); /* Responsive font size */
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: -0.5px;
        }
        .section-subtitle {
            font-size: clamp(1rem, 4vw, 1.25rem);
            color: var(--color-text);
            text-align: center;
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        /* Feature icon styling */
        .feature-icon {
            font-size: 2rem; /* Slightly larger icons */
            color: var(--color-primary);
            margin-right: 1rem;
            width: 40px; /* Fixed width for alignment */
            text-align: center;
        }
        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-primary-dark);
        }

        /* Ensure Chart.js chart is responsive */
        #progressChartContainer {
            position: relative;
            height: 40vh; /* Or any desired height */
            width: 100%;
            max-width: 800px; /* Optional: constrain max width */
            margin: 2rem auto; /* Center it */
        }

        /* Helper for active section highlighting */
        .active-section {
             /* Could add a subtle border or background, but not strictly neumorphic for sections */
        }
        
        /* Adding a subtle focus to clickable cards for accessibility */
        .clickable-card:focus-within {
             box-shadow: var(--current-shadow), 0 0 0 3px rgba(var(--color-primary-rgb), 0.4);
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="antialiased">

    <!-- Header -->
    <header id="mainHeader" class="sticky top-0 z-50 py-5 px-6 neumorphic-card rounded-none shadow-lg">
        <div id="mainHeaderContainer" class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-3xl font-bold text-primary">Study IA</a>
            <button id="mobileMenuBtn" class="neumorphic-button md:hidden p-2.5">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <nav id="mainNav" class="hidden md:flex items-center space-x-1">
                <a href="#vision" class="nav-link">Visión</a>
                <a href="#caracteristicas" class="nav-link">Características</a>
                <a href="#tecnologia" class="nav-link">Tecnología</a>
                <a href="#fases" class="nav-link">Fases</a>
                <a href="#" id="dashboardLink" class="nav-link hidden">Dashboard</a>
                <div id="authButtons" class="ml-4">
                    <button id="loginBtn" class="neumorphic-button neumorphic-button-primary">Login</button>
                </div>
                <div id="userProfileContainer" class="user-profile-container hidden ml-3">
                    <img id="userAvatar" src="https://via.placeholder.com/40?text=U" alt="User Avatar" class="w-10 h-10 rounded-full neumorphic-card p-0.5" style="box-shadow: var(--current-shadow-inset);">
                    <span id="userName" class="ml-3 font-semibold text-sm"></span>
                    <button id="logoutBtn" class="neumorphic-button ml-3 text-xs !p-2">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6 mt-6">

        <section id="vision" class="my-16 scroll-mt-20">
            <div class="neumorphic-card p-8">
                <h2 class="section-title">Visión del Proyecto: Study IA</h2>
                <p class="section-subtitle">
                    Revolucionando el aprendizaje con una plataforma inteligente y adaptativa.
                </p>
                <p class="text-lg leading-relaxed mb-4">
                    Study IA es una plataforma de aprendizaje inteligente diseñada para transformar la forma en que estudiantes y profesionales abordan el estudio y la adquisición de conocimientos. 
                    Utilizando inteligencia artificial, Study IA ofrecerá herramientas personalizadas que se adaptan al ritmo y estilo de aprendizaje de cada usuario, optimizando su tiempo y mejorando la retención de información.
                </p>
                <p class="text-lg leading-relaxed">
                    El objetivo es crear un asistente de estudio virtual que no solo organice el material, sino que también interactúe con el usuario a través de resúmenes, generación de preguntas, flashcards inteligentes y seguimiento detallado del progreso, todo dentro de una interfaz intuitiva y atractiva con diseño neumorfista.
                </p>
            </div>
        </section>

        <section id="caracteristicas" class="my-16 scroll-mt-20">
            <h2 class="section-title">Características Centrales</h2>
            <p class="section-subtitle">Herramientas poderosas para un aprendizaje efectivo.</p>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <div class="flex items-start mb-3">
                        <i class="fas fa-brain feature-icon"></i>
                        <h3 class="feature-title">Planes de Estudio Personalizados</h3>
                    </div>
                    <p class="text-sm">Algoritmos de IA que analizan el rendimiento y adaptan los planes de estudio, sugiriendo temas y recursos específicos.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <div class="flex items-start mb-3">
                        <i class="fas fa-file-alt feature-icon"></i>
                        <h3 class="feature-title">Resúmenes Inteligentes (Premium)</h3>
                    </div>
                    <p class="text-sm">Capacidad de procesar documentos (PDF, TXT) y generar resúmenes concisos, destacando puntos clave. Requiere suscripción.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <div class="flex items-start mb-3">
                        <i class="fas fa-question-circle feature-icon"></i>
                        <h3 class="feature-title">Generador de Preguntas (Premium)</h3>
                    </div>
                    <p class="text-sm">A partir de un texto, la IA crea preguntas de práctica para autoevaluación. Requiere suscripción.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <div class="flex items-start mb-3">
                        <i class="fas fa-layer-group feature-icon"></i>
                        <h3 class="feature-title">Flashcards Inteligentes</h3>
                    </div>
                    <p class="text-sm">Creación automática de flashcards con sistema de repetición espaciada para optimizar la memorización.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <div class="flex items-start mb-3">
                        <i class="fas fa-chart-line feature-icon"></i>
                        <h3 class="feature-title">Seguimiento de Progreso</h3>
                    </div>
                    <p class="text-sm">Dashboard visual con estadísticas sobre tiempo de estudio, temas cubiertos y rendimiento.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                     <div class="flex items-start mb-3">
                        <i class="fas fa-cloud-upload-alt feature-icon"></i>
                        <h3 class="feature-title">Almacenamiento en la Nube (Premium)</h3>
                    </div>
                    <p class="text-sm">Sube tus materiales (PDFs, notas) para ser procesados y organizados por la IA. Requiere suscripción.</p>
                </div>
            </div>
             <div class="text-center mt-10">
                <button id="ctaSubscribeFeatures" class="neumorphic-button neumorphic-button-primary text-lg">
                    <i class="fas fa-star mr-2"></i>Acceder a Funciones Premium
                </button>
            </div>
        </section>
        
        <section id="diseno" class="my-16 scroll-mt-20">
            <div class="neumorphic-card p-8">
                <h2 class="section-title">Diseño y Estilo: Neumorfismo</h2>
                <p class="section-subtitle">Una experiencia de usuario moderna, limpia y atractiva.</p>
                <div class="md:flex md:items-center">
                    <div class="md:w-1/2 md:pr-8 mb-6 md:mb-0">
                        <p class="text-lg leading-relaxed mb-4">
                            La interfaz de Study IA adoptará un estilo <strong class="text-primary">Neumorfista</strong>. Este enfoque de diseño se caracteriza por elementos que parecen emerger del fondo, creando una sensación táctil y suave. 
                            Utiliza sombras y luces sutiles para simular profundidad y volumen.
                        </p>
                        <ul class="list-none space-y-3 text-md">
                            <li class="flex items-center"><i class="fas fa-palette fa-fw mr-3 text-accent"></i><strong class="mr-2">Paleta:</strong>Suaves pasteles, primario vibrante.</li>
                            <li class="flex items-center"><i class="fas fa-font fa-fw mr-3 text-accent"></i><strong class="mr-2">Tipografía:</strong>Poppins, clara y legible.</li>
                            <li class="flex items-center"><i class="fas fa-icons fa-fw mr-3 text-accent"></i><strong class="mr-2">Iconos:</strong>Minimalistas y consistentes.</li>
                            <li class="flex items-center"><i class="fas fa-hand-pointer fa-fw mr-3 text-accent"></i><strong class="mr-2">Interacción:</strong>Transiciones suaves, efecto "inset".</li>
                        </ul>
                    </div>
                    <div class="md:w-1/2 grid grid-cols-2 gap-4">
                        <div class="neumorphic-card !p-4 text-center aspect-square flex flex-col justify-center items-center"><i class="fas fa-lightbulb fa-3x text-primary mb-2"></i>Elemento 1</div>
                        <div class="neumorphic-card !p-4 text-center aspect-square flex flex-col justify-center items-center !shadow-[var(--current-shadow-inset)]"><i class="fas fa-cube fa-3x text-primary mb-2"></i>Elemento Inset</div>
                        <button class="neumorphic-button col-span-2">Botón Neumórfico</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="tecnologia" class="my-16 scroll-mt-20">
            <h2 class="section-title">Arquitectura Tecnológica</h2>
            <p class="section-subtitle">Componentes modernos para una plataforma robusta y escalable.</p>
            <div class="neumorphic-card p-8">
                <div class="grid md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                        <h3 class="text-xl font-semibold text-primary-dark mb-3"><i class="fas fa-desktop mr-2"></i>Frontend</h3>
                        <ul class="list-disc list-inside space-y-1 pl-2">
                            <li>Vanilla JavaScript con Tailwind CSS</li>
                            <li>Neumorfismo (CSS personalizado)</li>
                            <li>Chart.js para gráficos de progreso</li>
                            <li>Firebase JS SDK (v11.6.1 Módulos ES)</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-primary-dark mb-3"><i class="fas fa-server mr-2"></i>Backend & Base de Datos</h3>
                        <ul class="list-disc list-inside space-y-1 pl-2">
                            <li>Firebase (Authentication, Firestore, Storage)</li>
                            <li>Firestore (NoSQL) para datos de usuario</li>
                            <li>Firebase Storage para archivos (PDFs)</li>
                        </ul>
                    </div>
                    <div class="md:col-span-2">
                        <h3 class="text-xl font-semibold text-primary-dark mb-3 mt-4"><i class="fas fa-microchip mr-2"></i>Inteligencia Artificial</h3>
                        <p class="mb-2 text-sm">Inicialmente simulado en frontend, con planes de integración real:</p>
                        <ul class="list-disc list-inside space-y-1 pl-2">
                            <li>Procesamiento de Lenguaje Natural (NLP): APIs (OpenAI, Cohere) o modelos Hugging Face.</li>
                            <li>Algoritmos de Aprendizaje Adaptativo: Lógica personalizada.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="progreso-dev" class="my-16 scroll-mt-20">
            <h2 class="section-title">Progreso del Desarrollo (Simulado)</h2>
            <p class="section-subtitle">Visualización del avance en las funcionalidades clave.</p>
            <div class="neumorphic-card p-8">
                <div id="progressChartContainer">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
        </section>

        <section id="fases" class="my-16 scroll-mt-20">
            <h2 class="section-title">Fases de Desarrollo</h2>
            <p class="section-subtitle">Un enfoque iterativo para construir Study IA.</p>
            <div class="space-y-6">
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <h3 class="feature-title mb-1">Fase 1: MVP (Producto Mínimo Viable)</h3>
                    <p class="text-sm">Autenticación, diseño base, carga de PDF (simulada), simulación frontend de IA (resúmenes, Q&A), dashboard básico (Chart.js), simulación de suscripción.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <h3 class="feature-title mb-1">Fase 2: Integración IA y Funciones Core</h3>
                    <p class="text-sm">Integración API NLP, flashcards inteligentes, persistencia de datos en Firestore, dashboard con datos reales.</p>
                </div>
                <div class="neumorphic-card p-6 clickable-card" tabindex="0">
                    <h3 class="feature-title mb-1">Fase 3: Personalización y Escalabilidad</h3>
                    <p class="text-sm">Algoritmo de planes de estudio personalizados, optimización, funciones colaborativas (opcional), mejoras iterativas.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-10 text-center neumorphic-card rounded-none mt-16">
        <p class="text-md">&copy; <span id="currentYear"></span> Study IA. Todos los derechos reservados.</p>
        <p class="text-sm text-gray-600 mt-1">Innovando el aprendizaje con Inteligencia Artificial.</p>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content neumorphic-card">
            <span class="modal-close" data-modal-id="loginModal">&times;</span>
            <h2 class="text-2xl font-bold text-primary mb-6 text-center">Iniciar Sesión</h2>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="loginEmail" class="block text-sm font-semibold mb-2">Email</label>
                    <input type="email" id="loginEmail" class="neumorphic-input" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-semibold mb-2">Contraseña</label>
                    <input type="password" id="loginPassword" class="neumorphic-input" required>
                </div>
                <button type="submit" class="neumorphic-button neumorphic-button-primary w-full py-3">Login</button>
            </form>
            <p id="loginError" class="text-red-500 text-sm mt-4 text-center h-4"></p>
            <p class="mt-4 text-center text-sm">¿No tienes cuenta? <a href="#" id="showRegisterLink" class="text-primary hover:underline font-semibold">Regístrate</a></p>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content neumorphic-card">
            <span class="modal-close" data-modal-id="registerModal">&times;</span>
            <h2 class="text-2xl font-bold text-primary mb-6 text-center">Crear Cuenta</h2>
            <form id="registerForm" class="space-y-5">
                <div>
                    <label for="registerName" class="block text-sm font-semibold mb-2">Nombre Completo</label>
                    <input type="text" id="registerName" class="neumorphic-input" required>
                </div>
                <div>
                    <label for="registerEmail" class="block text-sm font-semibold mb-2">Email</label>
                    <input type="email" id="registerEmail" class="neumorphic-input" required>
                </div>
                <div>
                    <label for="registerPassword" class="block text-sm font-semibold mb-2">Contraseña</label>
                    <input type="password" id="registerPassword" class="neumorphic-input" required minlength="6">
                </div>
                <button type="submit" class="neumorphic-button neumorphic-button-primary w-full py-3">Registrarse</button>
            </form>
            <p id="registerError" class="text-red-500 text-sm mt-4 text-center h-4"></p>
            <p class="mt-4 text-center text-sm">¿Ya tienes cuenta? <a href="#" id="showLoginLink" class="text-primary hover:underline font-semibold">Inicia Sesión</a></p>
        </div>
    </div>
    
    <!-- Subscription Modal -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content neumorphic-card">
            <span class="modal-close" data-modal-id="subscriptionModal">&times;</span>
            <h2 class="text-2xl font-bold text-primary mb-3 text-center">Desbloquea Todo el Potencial</h2>
            <p class="text-center text-sm mb-5">Elige un plan para acceder a funciones premium como análisis de documentos y herramientas IA avanzadas.</p>
            
            <div class="neumorphic-card p-5 mb-5 !shadow-[var(--current-shadow-inset)] bg-primary-light-transparent">
                <h3 class="text-xl font-semibold text-primary-dark mb-2">Plan Premium Mensual</h3>
                <p class="text-3xl font-bold mb-1 text-primary-dark">$20 <span class="text-sm font-normal">/ mes</span></p>
                <p class="text-xs text-gray-600 mb-3">Acceso completo, almacenamiento ilimitado, soporte prioritario.</p>
                <button id="subscribeBtn" class="neumorphic-button neumorphic-button-primary w-full py-2.5">Suscribirse (Simulado)</button>
            </div>

            <div id="paymentSimulation" class="hidden mt-5">
                 <h4 class="text-md font-semibold text-primary-dark mb-2">Simulación de Pago (Crypto):</h4>
                 <p class="text-xs mb-1">Para completar tu suscripción (simulada):</p>
                 <p class="text-xs mb-1">1. Envía <strong class="text-primary">20 USDT</strong> (BEP20/BSC) a:</p>
                 <p class="neumorphic-input !text-xs !p-2 my-2 break-all" id="cryptoWalletAddress">0xAbCdEf1234567890AbCdEf1234567890AbCdEf12</p>
                 <p class="text-xs mb-3">2. Una vez enviado, haz clic en "Confirmar Pago".</p>
                 <button id="confirmPaymentBtn" class="neumorphic-button w-full !py-2">Confirmar Pago (Simulado)</button>
            </div>
            <p id="subscriptionMsg" class="text-center mt-3 text-sm h-4"></p>
        </div>
    </div>

    <!-- Generic Message Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content neumorphic-card text-center">
            <span class="modal-close" data-modal-id="messageModal">&times;</span>
            <h2 id="messageModalTitle" class="text-2xl font-bold text-primary mb-4">Mensaje</h2>
            <p id="messageModalText" class="text-lg mb-6"></p>
            <button id="messageModalCloseBtn" class="neumorphic-button">Entendido</button>
        </div>
    </div>

    <script type="module">
        // Firebase App (Core)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Firebase Authentication
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // Firebase Firestore (Database)
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // Firebase Storage
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js"; // Renamed 'ref' to 'storageRef' to avoid conflict with DOM ref

        // It's highly recommended to manage API keys via environment variables or a secure backend.
        const firebaseConfig = {
            apiKey: "AIzaSyD_keM1ifeE9I2ttjFZyGYEGu9E34m8ns8", 
            authDomain: "study-ia-15ac8.firebaseapp.com", 
            projectId: "study-ia-15ac8",   
            storageBucket: "study-ia-15ac8.firebasestorage.app", 
            messagingSenderId: "27148653401", 
            appId: "1:27148653401:web:d7ebcda9d30b3e65c2f248", 
            measurementId: "G-W2QDH8MERJ" 
        };

        // Initialize Firebase (local scope)
        const firebaseApp = initializeApp(firebaseConfig);
        const firebaseAuth = getAuth(firebaseApp);
        const firestoreDB = getFirestore(firebaseApp);
        const firebaseStorage = getStorage(firebaseApp);

        // Global state variables (can be localized further if desired, but kept on window for now as per instructions)
        window.currentUser = null; 
        window.userSubscriptionPlan = 'free'; 
        
        // DOM Elements
        const uiElements = {
            loginBtn: document.getElementById('loginBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            authButtons: document.getElementById('authButtons'),
            userProfileContainer: document.getElementById('userProfileContainer'),
            userName: document.getElementById('userName'),
            userAvatar: document.getElementById('userAvatar'),
            dashboardLink: document.getElementById('dashboardLink'),
            
            loginModal: document.getElementById('loginModal'),
            registerModal: document.getElementById('registerModal'),
            subscriptionModal: document.getElementById('subscriptionModal'),
            messageModal: document.getElementById('messageModal'),

            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            
            showRegisterLink: document.getElementById('showRegisterLink'),
            showLoginLink: document.getElementById('showLoginLink'),

            subscribeBtn: document.getElementById('subscribeBtn'),
            ctaSubscribeFeatures: document.getElementById('ctaSubscribeFeatures'),
            paymentSimulation: document.getElementById('paymentSimulation'),
            confirmPaymentBtn: document.getElementById('confirmPaymentBtn'),
            subscriptionMsg: document.getElementById('subscriptionMsg'),

            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            mainNav: document.getElementById('mainNav'),
            navLinks: document.querySelectorAll('.nav-link'),
            sections: document.querySelectorAll('main section[id]'),

            messageModalTitle: document.getElementById('messageModalTitle'),
            messageModalText: document.getElementById('messageModalText'),
            messageModalCloseBtn: document.getElementById('messageModalCloseBtn'),

            currentYear: document.getElementById('currentYear'),
            progressChartCanvas: document.getElementById('progressChart'),

            // AI Tools UI Elements (to be managed by subscription status)
            summarizeBtn: document.getElementById('summarizeBtn'),
            textToSummarize: document.getElementById('textToSummarize'),
            summaryOutput: document.getElementById('summaryOutput'),
            generateQABtn: document.getElementById('generateQABtn'),
            textForQA: document.getElementById('textForQA'),
            qaOutput: document.getElementById('qaOutput'),
            
            // AI Tool Tab buttons for visual cues
            summarizerTabBtn: document.querySelector('[data-tab="summarizer"]'),
            qaGeneratorTabBtn: document.querySelector('[data-tab="qa-generator"]'),
            flashcardsTabBtn: document.querySelector('[data-tab="flashcards"]'), // For styling consistency
            pdfUploadTabBtn: document.querySelector('[data-tab="pdf-upload"]') // For styling consistency
        };

        // --- Modal Logic ---
        const openModal = (modal) => { 
            if (modal) modal.style.display = 'flex'; 
            setTimeout(() => { // Ensure display:flex is applied before adding class
                if (modal && modal.firstElementChild) modal.firstElementChild.classList.add('modal-open-animate');
            }, 10);
        };
        const closeModal = (modal) => {
            if (modal && modal.firstElementChild) {
                modal.firstElementChild.classList.remove('modal-open-animate'); // Optional: add close animation class
            }
            if (modal) modal.style.display = 'none';
        };

        uiElements.loginBtn?.addEventListener('click', () => openModal(uiElements.loginModal));
        
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', () => closeModal(document.getElementById(btn.dataset.modalId)));
        });
        uiElements.messageModalCloseBtn?.addEventListener('click', () => closeModal(uiElements.messageModal));

        window.addEventListener('click', (event) => {
            if (event.target === uiElements.loginModal) closeModal(uiElements.loginModal);
            if (event.target === uiElements.registerModal) closeModal(uiElements.registerModal);
            if (event.target === uiElements.subscriptionModal) closeModal(uiElements.subscriptionModal);
            if (event.target === uiElements.messageModal) closeModal(uiElements.messageModal);
        });
        
        const showMessageModal = (title, text) => {
            if(uiElements.messageModalTitle) uiElements.messageModalTitle.textContent = title;
            if(uiElements.messageModalText) uiElements.messageModalText.textContent = text;
            openModal(uiElements.messageModal);
        };

        // --- Auth UI & Logic ---
        uiElements.logoutBtn?.addEventListener('click', () => {
            signOut(firebaseAuth).catch(error => console.error("Sign out error", error));
        });

        uiElements.showRegisterLink?.addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(uiElements.loginModal);
            openModal(uiElements.registerModal);
        });
        uiElements.showLoginLink?.addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(uiElements.registerModal);
            openModal(uiElements.loginModal);
        });

        onAuthStateChanged(firebaseAuth, async (user) => {
            window.currentUser = user;
            if (user) {
                renderProgressChart(); // Call chart rendering when user is confirmed
                uiElements.authButtons?.classList.add('hidden');
                uiElements.userProfileContainer?.classList.remove('hidden');
                uiElements.userProfileContainer?.classList.add('flex');
                uiElements.dashboardLink?.classList.remove('hidden');
                uiElements.userName.textContent = user.displayName || user.email.split('@')[0];
                if(user.photoURL) uiElements.userAvatar.src = user.photoURL;
                else uiElements.userAvatar.src = `https://via.placeholder.com/40?text=${(user.displayName || user.email)[0].toUpperCase()}`;

                try {
                    const userDocRef = doc(firestoreDB, 'users', user.uid);
                    const docSnap = await getDoc(userDocRef);
                    if (docSnap.exists() && docSnap.data().subscriptionPlan) {
                        window.userSubscriptionPlan = docSnap.data().subscriptionPlan;
                    } else {
                        window.userSubscriptionPlan = 'free'; // Default if not set
                        if (!docSnap.exists()) { // Create user doc if it doesn't exist from registration
                             await setDoc(userDocRef, {
                                displayName: user.displayName,
                                email: user.email,
                                createdAt: serverTimestamp(),
                                subscriptionPlan: 'free'
                            });
                        }
                    }
                } catch (err) {
                    console.error("Error fetching/creating user data:", err);
                    window.userSubscriptionPlan = 'free';
                }
            } else {
                uiElements.authButtons?.classList.remove('hidden');
                uiElements.userProfileContainer?.classList.add('hidden');
                uiElements.userProfileContainer?.classList.remove('flex');
                uiElements.dashboardLink?.classList.add('hidden');
                uiElements.userName.textContent = '';
                uiElements.userAvatar.src = 'https://via.placeholder.com/40?text=U';
                window.userSubscriptionPlan = 'free';
            }
            updateUIBasedOnSubscription();
            renderProgressChart(); // Also call here to handle logged-out state or initial load with no user
        });

        uiElements.loginForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = uiElements.loginForm.loginEmail.value;
            const password = uiElements.loginForm.loginPassword.value;
            const errorEl = document.getElementById('loginError');
            if(errorEl) errorEl.textContent = '';

            signInWithEmailAndPassword(firebaseAuth, email, password)
                .then(userCredential => {
                    closeModal(uiElements.loginModal);
                    uiElements.loginForm.reset();
                })
                .catch(error => {
                    if(errorEl) errorEl.textContent = error.message.includes("auth/invalid-credential") ? "Credenciales incorrectas." : error.message;
                    console.error("Login Error:", error);
                });
        });

        uiElements.registerForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = uiElements.registerForm.registerName.value;
            const email = uiElements.registerForm.registerEmail.value;
            const password = uiElements.registerForm.registerPassword.value;
            const errorEl = document.getElementById('registerError');
            if(errorEl) errorEl.textContent = '';

            createUserWithEmailAndPassword(firebaseAuth, email, password)
                .then(async (userCredential) => {
                    await updateProfile(userCredential.user, { displayName: name });
                    const userDocRef = doc(firestoreDB, "users", userCredential.user.uid);
                    await setDoc(userDocRef, {
                        displayName: name,
                        email: email,
                        createdAt: serverTimestamp(),
                        subscriptionPlan: 'free'
                    });
                    closeModal(uiElements.registerModal);
                    uiElements.registerForm.reset();
                })
                .catch(error => {
                    if(errorEl) errorEl.textContent = error.message;
                    console.error("Register Error:", error);
                });
        });
        
        // --- Subscription Logic & UI ---
        const handleSubscriptionClick = () => {
            if (!window.currentUser) {
                showMessageModal("Autenticación Requerida", "Por favor, inicia sesión o regístrate para suscribirte.");
                return;
            }
             if (window.userSubscriptionPlan === 'premium') {
                showMessageModal("Ya Suscrito", "¡Ya disfrutas de nuestro Plan Premium!");
                return;
            }
            openModal(uiElements.subscriptionModal);
            uiElements.paymentSimulation?.classList.add('hidden'); 
            if(uiElements.subscriptionMsg) uiElements.subscriptionMsg.textContent = ''; 
        };
        
        uiElements.subscribeBtn?.addEventListener('click', () => {
            uiElements.paymentSimulation?.classList.remove('hidden');
            if(uiElements.subscriptionMsg) {
                uiElements.subscriptionMsg.textContent = 'Sigue las instrucciones para completar el pago.';
                uiElements.subscriptionMsg.className = 'text-center mt-3 text-sm text-blue-600 h-4';
            }
        });
        uiElements.ctaSubscribeFeatures?.addEventListener('click', handleSubscriptionClick);


        uiElements.confirmPaymentBtn?.addEventListener('click', async () => {
            if (!window.currentUser) return; 

            if(uiElements.subscriptionMsg) {
                uiElements.subscriptionMsg.textContent = 'Procesando confirmación...';
                uiElements.subscriptionMsg.className = 'text-center mt-3 text-sm text-blue-600 h-4';
            }
            uiElements.confirmPaymentBtn.disabled = true;

            try {
                const userDocRef = doc(firestoreDB, "users", window.currentUser.uid);
                await updateDoc(userDocRef, {
                    subscriptionPlan: 'premium',
                    subscriptionUpdatedAt: serverTimestamp()
                });
                window.userSubscriptionPlan = 'premium';
                updateUIBasedOnSubscription();
                if(uiElements.subscriptionMsg) {
                    uiElements.subscriptionMsg.textContent = '¡Suscripción Premium Activada! Gracias.';
                    uiElements.subscriptionMsg.className = 'text-center mt-3 text-sm text-green-600 font-semibold h-4';
                }
                setTimeout(() => closeModal(uiElements.subscriptionModal), 2500);
            } catch (error) {
                console.error("Error updating subscription:", error);
                 if(uiElements.subscriptionMsg) {
                    uiElements.subscriptionMsg.textContent = 'Error al actualizar. Intenta de nuevo.';
                    uiElements.subscriptionMsg.className = 'text-center mt-3 text-sm text-red-500 h-4';
                }
            } finally {
                 uiElements.confirmPaymentBtn.disabled = false;
            }
        });
        
        window.updateUIBasedOnSubscription = () => {
            const isPremium = window.userSubscriptionPlan === 'premium';

            // Subscription buttons
            if (uiElements.subscribeBtn) {
                uiElements.subscribeBtn.textContent = isPremium ? 'Ya Estás Suscrito' : 'Suscribirse (Simulado)';
                uiElements.subscribeBtn.disabled = isPremium;
            }
            if (uiElements.ctaSubscribeFeatures) {
                 uiElements.ctaSubscribeFeatures.textContent = isPremium ? 'Acceso Premium Activado' : 'Acceder a Funciones Premium';
                 uiElements.ctaSubscribeFeatures.disabled = isPremium;
                 if(isPremium) uiElements.ctaSubscribeFeatures.classList.replace('neumorphic-button-primary', 'neumorphic-button');
                 else uiElements.ctaSubscribeFeatures.classList.replace('neumorphic-button', 'neumorphic-button-primary');
            }
            
            // Update main page feature titles "(Premium)" text
             document.querySelectorAll('#caracteristicas .feature-title').forEach(titleEl => {
                const originalText = titleEl.dataset.originalText || titleEl.textContent;
                titleEl.dataset.originalText = originalText; // Store original text if not already stored

                if (originalText.includes('(Premium)')) {
                    if (isPremium) {
                        titleEl.innerHTML = originalText.replace('(Premium)', '<span class="text-xs text-accent ml-1">(Activado)</span>');
                    } else {
                        titleEl.innerHTML = originalText; // Revert to original text which includes "(Premium)"
                    }
                }
            });

            // AI Tools specific UI updates
            const premiumMessage = 'Función Premium. Suscríbete para desbloquear.';
            const defaultSummarizerTitle = 'Resumidor de Texto';
            const defaultQAGeneratorTitle = 'Generador de Preguntas';

            if (uiElements.summarizeBtn) uiElements.summarizeBtn.disabled = !isPremium;
            if (uiElements.textToSummarize) uiElements.textToSummarize.disabled = !isPremium;
            if (uiElements.generateQABtn) uiElements.generateQABtn.disabled = !isPremium;
            if (uiElements.textForQA) uiElements.textForQA.disabled = !isPremium;

            if (uiElements.summarizerTabBtn) {
                uiElements.summarizerTabBtn.style.opacity = isPremium ? '1' : '0.65';
                uiElements.summarizerTabBtn.title = isPremium ? defaultSummarizerTitle : premiumMessage;
            }
            if (uiElements.qaGeneratorTabBtn) {
                uiElements.qaGeneratorTabBtn.style.opacity = isPremium ? '1' : '0.65';
                uiElements.qaGeneratorTabBtn.title = isPremium ? defaultQAGeneratorTitle : premiumMessage;
            }
            // Ensure free tabs are fully opaque and have default titles
            if (uiElements.flashcardsTabBtn) {
                uiElements.flashcardsTabBtn.style.opacity = '1';
                uiElements.flashcardsTabBtn.title = 'Flashcards Inteligentes';
            }
            if (uiElements.pdfUploadTabBtn) {
                uiElements.pdfUploadTabBtn.style.opacity = '1';
                uiElements.pdfUploadTabBtn.title = 'Subir PDF para Análisis';
            }

            // Clear outputs or show premium message if user is not premium or logs out
            if (!isPremium) {
                if (uiElements.summaryOutput) uiElements.summaryOutput.innerHTML = `<p class="text-center text-accent p-4">${premiumMessage}</p>`;
                if (uiElements.qaOutput) uiElements.qaOutput.innerHTML = `<p class="text-center text-accent p-4">${premiumMessage}</p>`;
            } else {
                 // When user becomes premium, clear these messages if they were set
                 if (uiElements.summaryOutput && uiElements.summaryOutput.innerHTML.includes(premiumMessage)) {
                    uiElements.summaryOutput.innerHTML = '';
                 }
                 if (uiElements.qaOutput && uiElements.qaOutput.innerHTML.includes(premiumMessage)) {
                    uiElements.qaOutput.innerHTML = '';
                 }
            }
        };

        // --- General UI & Utility ---
        if(uiElements.currentYear) uiElements.currentYear.textContent = new Date().getFullYear();
        
        // Smooth scrolling & Active Link Highlighting
        const updateActiveLink = () => {
            let currentSectionId = '';
            uiElements.sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - (uiElements.mainNav.offsetHeight + 25) ) { // Adjusted offset
                    currentSectionId = section.getAttribute('id');
                }
            });

            uiElements.navLinks.forEach(link => {
                link.classList.remove('active-link');
                if (link.getAttribute('href') === `#${currentSectionId}`) {
                    link.classList.add('active-link');
                }
            });
        };
        window.addEventListener('scroll', updateActiveLink);
        updateActiveLink(); // Initial call

        uiElements.navLinks.forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                     // Calculate position considering sticky header height
                    const headerOffset = uiElements.mainHeader.offsetHeight + 20; // Extra padding
                    const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
                    const offsetPosition = elementPosition - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
                if (uiElements.mainNav.classList.contains('active')) { // For mobile
                    uiElements.mainNav.classList.remove('active');
                }
            });
        });
        
        uiElements.mobileMenuBtn?.addEventListener('click', () => {
            uiElements.mainNav?.classList.toggle('active');
            const icon = uiElements.mobileMenuBtn.querySelector('i');
            icon?.classList.toggle('fa-bars');
            icon?.classList.toggle('fa-times');
        });

        uiElements.dashboardLink?.addEventListener('click', (e) => {
            e.preventDefault();
            if (!window.currentUser) {
                openModal(uiElements.loginModal);
            } else if (window.userSubscriptionPlan !== 'premium') {
                handleSubscriptionClick();
            } else {
                showMessageModal("Dashboard Acceso", "¡Bienvenido a tu Dashboard Premium! (Contenido del dashboard se mostraría aquí).");
            }
        });
        
        // --- Chart.js Example ---
        let progressChartInstance = null;
        const renderProgressChart = async () => {
            if (!uiElements.progressChartCanvas) return;
            const ctx = uiElements.progressChartCanvas.getContext('2d');

            let chartDataConfig = {
                labels: ['Sin datos'],
                datasets: [{
                    label: 'Horas de Estudio',
                    data: [],
                    backgroundColor: 'rgba(var(--color-primary-rgb), 0.2)',
                    borderColor: 'var(--color-primary)',
                    borderWidth: 2,
                    borderRadius: 5,
                    tension: 0.3,
                    fill: true,
                }, {
                    label: 'Tareas Completadas',
                    data: [],
                    backgroundColor: 'rgba(var(--color-accent-rgb, 255 171 118) / 0.2)', // Added --color-accent-rgb to :root
                    borderColor: 'var(--color-accent)',
                    borderWidth: 2,
                    borderRadius: 5,
                    tension: 0.3,
                    fill: true,
                }]
            };
            let chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } },
                plugins: { 
                    legend: { display: true, position: 'bottom' },
                    title: { display: true, text: 'Progreso del Estudio (Datos de Ejemplo)' } 
                }
            };

            if (window.currentUser) {
                try {
                    const userDocRef = doc(firestoreDB, 'users', window.currentUser.uid);
                    const docSnap = await getDoc(userDocRef);

                    if (docSnap.exists() && docSnap.data().progressEntries && docSnap.data().progressEntries.length > 0) {
                        const progressEntries = docSnap.data().progressEntries.sort((a,b) => new Date(a.timestamp) - new Date(b.timestamp)); // Sort by timestamp
                        
                        chartDataConfig.labels = progressEntries.map(entry => entry.label);
                        chartDataConfig.datasets[0].data = progressEntries.map(entry => entry.studyHours || 0);
                        chartDataConfig.datasets[1].data = progressEntries.map(entry => entry.tasksCompleted || 0);
                        chartOptions.plugins.title.text = 'Mi Progreso de Estudio';
                    } else {
                        // User is logged in, but no progress data found - use example data with a note
                        chartDataConfig.labels = ['Semana 1 (Ej.)', 'Semana 2 (Ej.)', 'Semana 3 (Ej.)', 'Semana 4 (Ej.)'];
                        chartDataConfig.datasets[0].data = [5, 7, 6, 8];
                        chartDataConfig.datasets[1].data = [10, 12, 15, 13];
                        chartOptions.plugins.title.text = 'Progreso (Ejemplo - Registra tu actividad)';
                    }
                } catch (error) {
                    console.error("Error fetching progress data:", error);
                    // Keep example data if Firestore fetch fails
                    chartDataConfig.labels = ['Error al cargar datos'];
                    chartOptions.plugins.title.text = 'Error al cargar datos de progreso';
                }
            } else {
                // No user logged in - use example data
                chartDataConfig.labels = ['Fase 1 (Ej.)', 'Fase 2 (Ej.)', 'Fase 3 (Ej.)'];
                chartDataConfig.datasets[0].data = [10, 20, 5]; // Example study hours
                chartDataConfig.datasets[1].data = [3, 5, 2];   // Example tasks completed
                chartOptions.plugins.title.text = 'Progreso General (Ejemplo - Inicia Sesión para ver el tuyo)';
            }

            if (progressChartInstance) {
                progressChartInstance.destroy();
            }
            
            // Add :root variable for accent color RGB if not already present
            if (!document.documentElement.style.getPropertyValue('--color-accent-rgb')) {
                 document.documentElement.style.setProperty('--color-accent-rgb', '255, 171, 118'); // Default if not in CSS :root
            }


            progressChartInstance = new Chart(ctx, {
                type: 'line', // Changed to line for better trend visualization of studyHours/tasksCompleted
                data: chartDataConfig,
                options: chartOptions
            });
        };
        
        // Call initializations
        // renderProgressChart() is now called within onAuthStateChanged.
        // updateUIBasedOnSubscription will be called by onAuthStateChanged
    </script>

    <!-- Separate script for AI tools simulations and DOMContentLoaded -->
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            // AI Tools Elements (re-declared here for this module's scope, or could be passed from global uiElements)
            const summarizeBtnDOM = document.getElementById('summarizeBtn');
            const textToSummarizeDOM = document.getElementById('textToSummarize');
            const summaryOutputDOM = document.getElementById('summaryOutput');

            const generateQABtnDOM = document.getElementById('generateQABtn');
            const textForQADOM = document.getElementById('textForQA');
            const qaOutputDOM = document.getElementById('qaOutput');
            
            // Helper to get the showMessageModal function if it's globally available from the other script
            const showGlobalMessageModal = (title, message) => {
                if (typeof window.showMessageModal === 'function') { 
                    window.showMessageModal(title, message);
                } else { 
                    alert(`${title}: ${message}`);
                    console.warn("Global showMessageModal not found, using alert fallback.");
                }
            };
            
            if (summarizeBtnDOM) {
                summarizeBtnDOM.addEventListener('click', function() {
                    if (window.userSubscriptionPlan !== 'premium') {
                        showGlobalMessageModal("Función Premium", "El Resumidor de Texto requiere una suscripción Premium.");
                        if (summaryOutputDOM) summaryOutputDOM.innerHTML = '<p class="text-center text-accent p-4">Función Premium. Suscríbete para usar el resumidor.</p>';
                        return;
                    }
                    const text = textToSummarizeDOM.value.trim();
                    if (text && summaryOutputDOM) {
                        summaryOutputDOM.innerHTML = '<p class="text-gray-500">Procesando resumen (simulado)...</p>';
                        setTimeout(() => {
                            const summary = "Este es un resumen simulado del texto proporcionado. " + text.substring(0, Math.min(text.length, 150)) + "... (Simulación)";
                            summaryOutputDOM.innerHTML = `<div class="neumorphic-card !shadow-[var(--current-shadow-inset)] !p-4"><h4 class="font-semibold text-primary mb-2">Resumen Generado:</h4><p class="text-sm">${summary}</p></div>`;
                        }, 1500);
                    } else if (summaryOutputDOM) {
                        summaryOutputDOM.innerHTML = '<p class="text-red-500 text-center">Por favor, ingresa texto para resumir.</p>';
                    }
                });
            }

            if (generateQABtnDOM) {
                generateQABtnDOM.addEventListener('click', function() {
                     if (window.userSubscriptionPlan !== 'premium') {
                        showGlobalMessageModal("Función Premium", "El Generador de Preguntas requiere una suscripción Premium.");
                        if (qaOutputDOM) qaOutputDOM.innerHTML = '<p class="text-center text-accent p-4">Función Premium. Suscríbete para generar preguntas.</p>';
                        return;
                    }
                    const text = textForQADOM.value.trim();
                    if (text && qaOutputDOM) {
                        qaOutputDOM.innerHTML = '<p class="text-gray-500">Generando Q&A (simulado)...</p>';
                        setTimeout(() => {
                            qaOutputDOM.innerHTML = `
                                <div class="neumorphic-card !shadow-[var(--current-shadow-inset)] !p-4 space-y-3">
                                    <div>
                                        <h4 class="font-semibold text-primary">Pregunta 1 (Simulada):</h4>
                                        <p class="text-sm">¿Cuál es el concepto principal presentado en el texto?</p>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-primary">Respuesta 1 (Simulada):</h4>
                                        <p class="text-sm">El concepto principal es la demostración de funcionalidades simuladas.</p>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-primary">Pregunta 2 (Simulada):</h4>
                                        <p class="text-sm">¿Qué tecnologías se mencionan en el contexto del desarrollo?</p>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-primary">Respuesta 2 (Simulada):</h4>
                                        <p class="text-sm">Se mencionan HTML, CSS, JavaScript y Firebase.</p>
                                    </div>
                                </div>`;
                        }, 1500);
                    } else if (qaOutputDOM) {
                        qaOutputDOM.innerHTML = '<p class="text-red-500 text-center">Por favor, ingresa texto para generar Q&A.</p>';
                    }
                });
            }

            // Flashcards (Free)
            const flashcard = document.getElementById('flashcard');
            const prevFlashcardBtn = document.getElementById('prevFlashcard');
            const nextFlashcardBtn = document.getElementById('nextFlashcard');
            if (flashcard) {
                const flashcardFront = flashcard.querySelector('.flashcard-front');
                const flashcardBack = flashcard.querySelector('.flashcard-back');
                let currentFlashcardIndex = 0;
                const flashcardData = [ // Ensure this data is defined
                    { q: "¿Qué es Neumorfismo?", a: "Un estilo de diseño que simula volumen y tacto con sombras y luces suaves." },
                    { q: "¿Versión de Firebase SDK usada?", a: "11.6.1 (Módulos ES)" },
                    { q: "¿Qué es Tailwind CSS?", a: "Un framework CSS de utilidad primero (utility-first)." }
                ];

                function updateFlashcardDisplay() {
                    if (!flashcardData || flashcardData.length === 0 || !flashcardFront || !flashcardBack) return;
                    flashcardFront.textContent = `Pregunta: ${flashcardData[currentFlashcardIndex].q}`;
                    flashcardBack.textContent = `Respuesta: ${flashcardData[currentFlashcardIndex].a}`;
                    flashcard.classList.remove('is-flipped');
                }

                flashcard.addEventListener('click', () => flashcard.classList.toggle('is-flipped'));
                prevFlashcardBtn?.addEventListener('click', () => {
                    currentFlashcardIndex = (currentFlashcardIndex - 1 + flashcardData.length) % flashcardData.length;
                    updateFlashcardDisplay();
                });
                nextFlashcardBtn?.addEventListener('click', () => {
                    currentFlashcardIndex = (currentFlashcardIndex + 1) % flashcardData.length;
                    updateFlashcardDisplay();
                });
                if(flashcardData.length > 0) updateFlashcardDisplay();
            }
            
            // PDF Upload (Simulation - Free)
            const uploadPdfBtn = document.getElementById('uploadPdfBtn');
            const pdfFile = document.getElementById('pdfFile');
            const pdfUploadStatus = document.getElementById('pdfUploadStatus');
            uploadPdfBtn?.addEventListener('click', () => {
                if (pdfFile?.files?.length > 0) {
                    const fileName = pdfFile.files[0].name;
                    if(pdfUploadStatus) {
                        pdfUploadStatus.textContent = `Subiendo "${fileName}" (simulado)...`;
                        pdfUploadStatus.className = 'text-center mt-3 text-sm text-blue-600 h-4';
                    }
                    setTimeout(() => {
                        if(pdfUploadStatus) {
                            pdfUploadStatus.textContent = `"${fileName}" analizado con éxito (simulado).`;
                            pdfUploadStatus.className = 'text-center mt-3 text-sm text-green-600 h-4';
                        }
                        if(pdfFile) pdfFile.value = '';
                    }, 2000);
                } else if (pdfUploadStatus) {
                    pdfUploadStatus.textContent = 'Por favor, selecciona un archivo PDF.';
                    pdfUploadStatus.className = 'text-center mt-3 text-sm text-red-500 h-4';
                }
            });

            // Tab switching logic
            const tabButtons = document.querySelectorAll('#ia-tools-tabs .tab-button');
            const tabContents = document.querySelectorAll('#ia-tools-content .tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;
                    if ((tabId === 'summarizer' || tabId === 'qa-generator') && window.userSubscriptionPlan !== 'premium') {
                         showGlobalMessageModal("Función Premium", `El acceso a "${button.textContent.trim()}" requiere una suscripción Premium.`);
                         return;
                    }

                    tabButtons.forEach(btn => btn.classList.remove('active', '!bg-primary', 'text-white'));
                    button.classList.add('active', '!bg-primary', 'text-white');
                    
                    tabContents.forEach(content => {
                        if (content.id === tabId) {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
            
            // Initial tab state: Activate the first non-premium tab if no tab is active.
            // Or, if a premium tab is active by default in HTML, and user is not premium, switch.
            const activeTabInitially = document.querySelector('#ia-tools-tabs .tab-button.active');
            let tabToActivate = null;

            if (activeTabInitially) {
                const activeTabId = activeTabInitially.dataset.tab;
                 if ((activeTabId === 'summarizer' || activeTabId === 'qa-generator') && window.userSubscriptionPlan !== 'premium'){
                    // Premium tab active by default, but user is not premium. Find first free tab.
                    tabToActivate = Array.from(tabButtons).find(btn => btn.dataset.tab === 'flashcards' || btn.dataset.tab === 'pdf-upload');
                 }
            } else if (tabButtons.length > 0) { // No tab is active by default
                 tabToActivate = Array.from(tabButtons).find(btn => btn.dataset.tab === 'flashcards' || btn.dataset.tab === 'pdf-upload');
            }
            
            if (tabToActivate) {
                tabToActivate.click();
            } else if (!activeTabInitially && tabButtons.length > 0) {
                tabButtons[0].click(); // Fallback to first tab if no free tabs found (should not happen with current setup)
            }


        });
    </script>
</body>
</html>
